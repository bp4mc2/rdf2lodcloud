@prefix elmo: <http://dotwebstack.org/def/elmo#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix config: <http://dotwebstack.org/configuration/>.
@prefix elmo-ps: <http://dotwebstack.org/def/elmo/persistence-strategy/>.

GRAPH config:Theatre {

  config:RecordUploadEndpoint a elmo:Endpoint;
    elmo:pathPattern "/upload";
    elmo:stage config:Stage;
    elmo:putService config:RecordUploadService
  .

  config:RecordUploadService a elmo:Service;
    elmo:stage config:Stage;
    elmo:transaction config:RecordUploadTransaction;
  .

  config:RecordUploadTransaction a elmo:Transaction;
    elmo:sequentialFlow (
      [
        a elmo:UpdateStep;
        elmo:backend config:UpdateBackend;
        elmo:query "clear graph <http://bp4mc2.org/example/records>"
      ]
      [
        a elmo:PersistenceStep;
        elmo:persistenceStrategy elmo-ps:InsertIntoGraph;
        elmo:backend config:UpdateBackend;
        elmo:targetGraph <http://bp4mc2.org/example/records>
      ]
    )
  .

}
